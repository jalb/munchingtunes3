<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml11.dtd">
	<head>
                <meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>JavaScript Munching Tunes by Jalb</title>
		<meta name="author" content="Jean-Alain Le Borgne jalb@pobox.com">
		<meta description="A Javascript version of the Munching Tunes display hack">
		<link rel="stylesheet" href="munchingsquares2.css"/>

	<!-- polyfill -->
	<script src="midi_js/inc/shim/Base64.js" type="text/javascript"></script>
	<script src="midi_js/inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="midi_js/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<!-- midi.js package -->
	<script src="midi_js/js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="midi_js/js/midi/gm.js" type="text/javascript"></script>
	<script src="midi_js/js/midi/loader.js" type="text/javascript"></script>
	<script src="midi_js/js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="midi_js/js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="midi_js/js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<!-- utils -->
	<script src="midi_js/js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="midi_js/js/util/dom_request_script.js" type="text/javascript"></script>

		<script type="text/javascript" src="log4javascript.js"></script>
		<script type="text/javascript" src="canvas.js"></script>
		<script type="text/javascript" src="munchingsquares2.js"></script>
		<script type="text/javascript">
			//<![CDATA[
			// Create the logger
			var log = log4javascript.getLogger(); 
		
			// Create a PopUpAppender with default options
			var popUpAppender = new log4javascript.PopUpAppender();
			
			// Change the desired configuration options
			popUpAppender.setFocusPopUp(true);
			popUpAppender.setNewestMessageAtTop(true);
			
			// Add the appender to the logger
			log.addAppender(popUpAppender);
			
			// Test the logger
			log.debug("Logger is ready!");
			//]]>
		</script>
<script type="text/javascript">

window.onload = function () {
	MIDI.loadPlugin({
		soundfontUrl: "./soundfont/",
		instrument: "acoustic_grand_piano",
		onprogress: function(state, progress) {
			console.log(state, progress);
		},
		onsuccess: function() {
			var delay = 0; // play one note every quarter second
			var note = 50; // the MIDI note
			var velocity = 127; // how hard the note hits
			// play the note
			MIDI.setVolume(0, 127);
			MIDI.noteOn(0, note, velocity, delay);
			MIDI.noteOff(0, note, delay + 0.75);
		}
	});
};

</script>

	</head>

	<body>
	<h1>JavaScript Munching Tunes by Jalb</h1>
	<table border="0"><tr><br><br><td></td></tr><tr><td>&nbsp;&nbsp;&nbsp;</td><td>
	<canvas class="Canvas" id="canvas" width="256" height="256"></canvas>
	</td></tr></table>
	<form name="TheForm" class="Form">
	Seed:&nbsp;<input type="text" name="Seed" value="127" maxlength=6 size=6 />
	<INPUT type="button" name="Start" value="Start" onClick="StartMunchingSquares(TheForm.Seed.value)">
	<INPUT type="button" name="Stop" value="Stop" onClick="StopMunchingSquares()">
	</form>
	<span class="Thanks">
	<p>Javascript graphics: <a href="http://developer.mozilla.org/en/docs/Drawing_Graphics_with_Canvas">Canvas</a> with IE compatibility by <a href="http://me.eae.net/archive/2005/12/29/canvas-in-ie/">Emil A. Eklund</a></p><br>
	<p>HSL to RGB color conversion by <a href="http://www.sharewonders.com/archives/2006/04/13/javascript-hsl-and-rgb-conversion-functions/">Bjorn Tipling</a></p><br>
	<p>For debugging I used the excellent <a href="http://www.timdown.co.uk/log4javascript/">log4javascript</a></p><br>
	<p>Original algorithm reference: M. Beeler, R.W. Gosper and R. Schroeppel: "HAKMEM", AIM-239, MIT AI Lab, February 1972. <a href="https://dspace.mit.edu/handle/1721.1/6086">https://dspace.mit.edu/handle/1721.1/6086</a></p><br>
	</span>
	</body>
</html>
